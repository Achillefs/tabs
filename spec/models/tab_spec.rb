require 'spec_helper'

describe Tab do
  subject { create(:tab) }
  
  it { subject.instrument.should eq('guitar') }
  it { subject.has_user?.should eq(true) }
  it { subject.tab_length.should eq(8) }
  
  it "doesn't allow 2 tabs with the same name" do
    first_tab = subject
    expect { create(:tab) }.to raise_error(ActiveRecord::RecordInvalid)
  end
  
  it { subject.to_text.should eq("   Smoke on the water   
------------------------
------------------------
------------------------
------------------------
2--5--7-----------------
0--3--5-----0--3--6--5--") }
  
  it { subject.to_page.should eq(subject.to_text) }
  
  context "long tab" do
    subject do
      tab = create(:tab)
      c = JSON.parse(tab.content)
      nc = []
      (1..9).each { nc.concat(c) }
      tab.content = nc.to_json
      tab
    end
  
    it { subject.to_page.should_not eq(subject.to_text) }
    it { subject.to_page.should eq("                               Smoke on the water                               
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
2--5--7-----------------2--5--7-----------------2--5--7-----------------2--5--7-
0--3--5-----0--3--6--5--0--3--5-----0--3--6--5--0--3--5-----0--3--6--5--0--3--5-

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
----------------2--5--7-----------------2--5--7-----------------2--5--7---------
----0--3--6--5--0--3--5-----0--3--6--5--0--3--5-----0--3--6--5--0--3--5-----0--3

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------2--5--7-----------------2--5--7-----------------------------------------
--6--5--0--3--5-----0--3--6--5--0--3--5-----0--3--6--5--------------------------") }
  end
end