require 'spec_helper'

describe Tab do
  subject { create(:tab) }
  
  it { subject.instrument.should eq('guitar') }
  it { subject.has_user?.should eq(true) }
  it { subject.tab_length.should eq(7) }
  
  context 'tab with pauses' do
    let(:tab) { create(:tab, content: '1|0-2|2 1|3-2|5 1|5-2|7 0 1|0 1|3 1|6 1|5') }
    
    it 'should correctly display pauses' do
      puts tab.to_text
      tab.to_text.should eq("   Smoke on the water   
------------------------
------------------------
------------------------
------------------------
2--5--7-----------------
0--3--5-----0--3--6--5--")
    end
  end
  
  it "doesn't allow 2 tabs with the same name" do
    first_tab = subject
    expect { create(:tab) }.to raise_error(ActiveRecord::RecordInvalid)
  end
  
  it { subject.to_text.should eq(" Smoke on the water  
---------------------
---------------------
---------------------
---------------------
2--5--7--------------
0--3--5--0--3--6--5--") }
  
  it { subject.to_page.should eq(subject.to_text) }
  
  context "long tab" do
    subject do
      tab = create(:tab)
      tab.content = (1..10).map { tab.content }.join(" ")
      tab
    end
  
    it { subject.to_page.should_not eq(subject.to_text) }
    it { subject.to_page.should eq("                               Smoke on the water                               
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
2--5--7--------------2--5--7--------------2--5--7--------------2--5--7----------
0--3--5--0--3--6--5--0--3--5--0--3--6--5--0--3--5--0--3--6--5--0--3--5--0--3--6-

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
----2--5--7--------------2--5--7--------------2--5--7--------------2--5--7------
-5--0--3--5--0--3--6--5--0--3--5--0--3--6--5--0--3--5--0--3--6--5--0--3--5--0--3

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------2--5--7--------------2--5--7--------------------------------------------
--6--5--0--3--5--0--3--6--5--0--3--5--0--3--6--5--------------------------------") }
  end
end